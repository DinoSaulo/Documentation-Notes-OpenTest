7 - [Passando dados entre os passos de teste](https://getopentest.org/docs/passing-data.html)

## Visão geral

A maioria dos cenários de automação de teste do mundo real exige tranferência de valores dados entre etapas de teste (por exemplo, ler o número de do pedido gerado por uma chamada a API e usa-lo na proxima etapa e validar o status da requisição da API).

O OpenTest fornece três técnicas para armazenar e recuperar dados de teste:

- **Armazenar os dados localmente**: para dados que serão acessados apenas pelo mesmo *actor* de teste que os gerou.

- **O armazenamento de dados compartilhado**: para dados que podem ser acessados por vários atores de teste que participam de um teste distribuido.

- **O armazenadmento de dados da sessão**: para dados acessiveis em vários testes e atores de teste e que duram toda a sessão de teste.

Abaixo está uma representação gráfica do tempo de vida dos três armazenamentos de dados:

![Armazenamento de dados](../img/data-stores.png)

Vamos ver agora como utilizar cada um desses tipos de armazenamento

## Dados locais ($localData)

Quando uma variável so for necessária em ações de teste executados em sequencia no mesmo ator de teste, a melhor técnica a ser usada é o armazenamento de dados local. Essa técnica é muito rápida, pois é feita localmente em um simples objeto na memória ao qual é possivel adicionar propriedades para que sejam recuperadas e usadas posteriormente.

Há duas maneira de acessar os valores de dados no armazenamento de dados local:

 - **O objeto `$localData`**: Este objeto pode ser usado para ler e gravar propriedades de dados de/para o armazenamento de dados local.

Exemplo:
```yaml
- script: |
    // Escreve o "username" no local data
    $localData.username = "john_doe";

    // Faz a leitura do username e armazena no log
    $log("The username is " + $localData.username);
```

Uma segunda opção é criar uma variável no JavaScript usando a sintaxe `var` e usa-la para armazenar e recuperar os dados. A única vantagem de armazenar os dados no objeto `$localData`, como no exemplo anterior, é que ele define a intenção de usar essa propriedade em uma ação de teste.
Exemplo do uso da sintaxe `var`:
```yaml
- description: Faz a leitura do username
  action: org.getopentest.selenium.ReadElementText
  args:
      locator: {css: p.username}

- script: |
    var username = $output.text

- description: Escreve o nome de usuário na caixa de texto "username"
  action: org.getopentest.selenium.SendKeys
  args:
    locator: {css: "input[name='username']"}
    text: $script username
```

O objeto `$localData` pode ser especificado ao chamar qualquer ação de teste regular ou uma ação de macro. O valor passado para esse argumento deve ser um objeto que contém um ou mais paras de valores-chave especificando uma lista de propriedades a serem gravadas no armazenamento de dados local. Abaixo está um segundo exemplo de como é possível escrever uma propriedade chamada `username` com o valor que foi gerado da action `ReadElementText`:

```yaml
- description: Leia o username
  action: org.getopentest.selenium.ReadElementText
  args:
      locator: {css: p.username}
      $localData:
        username: $output.text

- description: Escreva o "username" na caixa de texto
  action: org.getopentest.selenium.SendKeys
  args:
    locator: {css: "input[name='username']"}
    text: $localData.username
```

## Dados compartilhados ($sharedData)

Quando vários atores de teste participam de um mesmo teste, eles precisam compartilhar dados entre sí (é o que normalmente fazem), para isso pode utilizar esse método de dados compartilhados.
Ela funciona semelhante ao armazenamento com dados locais, mas ocorre um pequeno acréscimo de um pouco de desempenho, devido ao tráfego de uma rede adicional gerando os dados que serão enviados primeiro ao serviço de sincronização pelo ator que está gravando a propriedade de dados. Posteriormente ele será solicitado do serviço de sincronização pelo ator que irá ler o dado. Assim como com os dados locais, vistos anteriormente, há duas maneiras de acessar o armazenamento de dados compartilhado:

- O objeto `$sharedData`: Esse objeto pode ser usado para ler e gravar propriedades de dados de/para o armazenamento de forma compartilhada. Por exemplo:

ATOR 1
```yaml
- script: |
    // Escrever apropriedade "username" no shared data
    $sharedData.username  = "john_doe";
```

ATOR 2
```yaml
- script: |
    // Ler o username dos dados compartilhados e armazenar no LOG
    $log("The username is " + $sharedData.username);
```

O argumento `$sharedData` pode ser especificado para qualquer ação de teste regular. O valor passado como argumento deve ser um objeto que contém um ou mais valores-chave especificando uma lista de propriedades a serem gravadas no armazenamento de dados compartilhado.

No exemplo abaixo, o ator de teste escreve em uma propriedade chamada `username` e a preenche com o valor de saida de texto gerada pela ação `ReadElementText`:

`ACTOR 1 (Parte do teste)`
```yaml
- actor: ACTOR1
  segments:
    - segment: 1
      actions:
        - description: |
            Leia o nome de usuário e grava na propriedade de dados compartilhados "username"
        action: org.getopentest.selenium.ReadElementText
        args:
            locator: {css: p.username}
            $sharedData:
                username: $output.text
```

O segundo ator de teste irá ler a propriedade `username` compartilhada no segmento 2 do teste e a irá usa-la para especificar o valor de uma vairável da ação de teste:

`ACTOR 2 (Parte do teste)`
```yaml
- actor: ACTOR2
  segments:
    - segment: 2
      actions:
        - description: Escreve o nome do usuário no campo de texto com nome "username"
          action: org.getopentest.selenium.SendKeys
          args:
            locator: {css: "input[name='username']"}
            text: $sharedData.username
```

## Dados da sessão ($sessionData)

O armazenamento de dados da sessão irá ser util no compartilhamento de dados entre vários testes que serão executados na mesma sessão de teste. O uso do armazenamento de dados em sessão irá criar dependências entre os outros testes, essas podem ser muiuto dificeis de gerenciar e controlar, portanto, na documentação é recomendado evita-la.

Solucionar problemas de teste com falhas que usam `$sessionData` é muito mais dificil, pois não será APENAS necessário entender o que aconteceu no teste que falhou, mas também em todos os outros testes executados antes dele na mesma sessão. A sintaxe para trabalhar com o armazenamento de dados em sessão é semelhante ao armazenamento de dados locais e compartilhados, mas usando o argumento de ação global `$sessionData` e o objeto `$sessionData`.

```yaml
TODO: Exemplo da utilização do $sessionData
```