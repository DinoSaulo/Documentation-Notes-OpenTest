# [Estrutura do teste](https://getopentest.org/docs/test-structure.html)

## Visão geral

Por padrão, no OpenTest os casos de teste são definidos em arquivos individuais, que estão no repositório localizados na pasta [./test-repo/tests/](./../test-repo/tests/) e são escritos na sintaxe YAML. 

O [YAML](https://yaml.org/) é um formato de escrita amigável e bastante utilizado em outras ferramentas como Github Actions, Jenkinks e outros. Através dele é possivel criar, ler e modificar os testes em qualquer editor de texto de forma simples.


## Um exemplo de teste simples

O trecho de código abaixo é um teste do Selenium que executa três ações (etapas de teste):

Navega para a página inicial do GitHub.

Procura o texto "react" e pressiona ENTER.

Valida se o repositório React existe nos resultados da pesquisa.

```yaml
description: Verifique o repositório React no site do GitHub
tags: [smoke-tests]
actors:
  - actor: WEB
    segments:
      - segment: 1
        actions:
          - description: Navega para a página inicial do GitHub.
            action: org.getopentest.selenium.NavigateTo
            args:
              url: https://github.com

          - description: Digita "react" no campo de busca e pressiona ENTER.
            action: org.getopentest.selenium.SendKeys
            args:
              locator: { name: q }
              text: react
              sendEnter: true

          - description: Valida se o repositório React existe nos resultados da pesquisa
            action: org.getopentest.selenium.AssertElementVisible
            args:
              locator: { xpath: "//a[@href='/facebook/react']" }
```

## O *actor* de testes

A linha 3 do teste acima podemos ver o trecho `- actor: WEB`. Esse código define o início de uma nova seção de ator de teste e especifica o tipo de ator de teste que executará o teste descrito no arquivo. Sempre será necessário identificar o actor, pois em projetos complexos podem ser necessários vários tipos de atores de teste que podem estar atuando simultaneamente (por exemplo, um actor para testes mobile, um actor para testes web, um actor para testes de API, etc)
- O tipo do actor de teste é uma string cujo valor pode ser definido para qualquer coisa que seja relevante para o aplicativo em teste ou o projeto de automação de teste específico.
- Normalmente, o nome do actor, ou `actorType`, é definido como uma abreviação de três letras maiúsculas, como "WEB", "MOB" ou "API".
- O nome do actor deve ser exatamente igual a mesma string no arquivo de teste especificada para o parâmetro `actorType` no arquivo de configuração do actor de testes.

## O *segment* do arquivo de teste

A linha 5 do exemplo de teste de amostra o trecho `- segment: 1`. Esse código define o início de um novo segmento de teste.
Os segmentos de teste são executados de forma sequencial, o que significa que o segmento de número 2 só começará a ser executado após o término do segmento 1. Esse recurso é necessário apenas para testes distribuídos, para sincronizar o trabalho entre vários atores de teste executados em máquinas diferentes.
Entretanto, os arquivos de teste normalmente irão possuir apenas um único segmento de teste, assim como o exemplo do teste acima.

## A seção de *actions* de teste

Nas linhas 7 a 22 do exemplo do teste acima exibem os comandos que o ator de teste de testes executam (o teste propriamente dito). Esta seção consiste em três blocos de texto, cada um deles representando uma única ação de teste que desejamos realizar.

Vamos dar uma olhada na primeira ação de teste:

```yaml
 description: Navega para a página inicial do GitHub.
  action: org.getopentest.selenium.NavigateTo
  args:
    url: https://github.com
```

Os elementos que compões esse bloco de código de teste são:

O `-` (ou traço) que é usado para iddentificar que estamos adicionando uma nova ação de testes ao fluxo do nosso teste. No formato YAML, o traço é usado para adicionar um novo alemento ao array de actions que serão executados pelo actor.

A propriedade `description`, que é uma propriedade opicional, que tem como finalidade auxiliar a compreensão da função do respectivo passo de testes que será executado. A descrição da ação também é usada em logs e relatórios de execução de teste, portanto, é uma boa prática utilizala nos nosso testes implementados. ;)

O atibuto `description` especifica com algumas palavras chaves ação que será executada, e por qual tipo de driver. No caso do exemplo, será utilizado o Selenium, e ele irá utlizar o comando `NavigateTo`, que é utilizado para fazer o browser abrir um determinado URL. Esse comando é escrito usando os padrões da linguagem JAva.

A propriedade `arg` é uma lista de argumentos passados para a ação do teste, essa lista irá vaiar a quantidade de elementos, bem como o nome de cada um deles de acordo com a ação passada no parâmetro `action`. Para o argumento `NavigateTo`, o único argumento necessário é o `url`, que especifica o URL que será acessado.
A lsita de argumentos é muito vasta, e pode ser consultada na [documentação do OpenTest](https://getopentest.org/reference/selenium-keywords.html)


## Exemplo de um caso de tete um pouco mais completo

```yaml
description: Get repo branches from the GitHub API
tags: [smoke-tests]
actors:
  - actor: API
    segments:
      - segment: 1
        actions:
          - description: Perform the API call
            action: org.getopentest.actions.HttpRequest
            args:
              url: https://api.github.com/repos/facebook/react/branches
              verb: GET

          - description: Verify that the branches array exists and is not empty
            script: |
              var branches = $output.body;

              if (!branches || (branches.length == 0)) {
                  $fail("Response body invalid or contains no branch elements.");
              } else {
                  $log($format(
                    "The GitHub API returned {0} branches",
                    branches.length));
              }
```

Acima está um exemplo de um teste um pouco mais complexo, pois ele inclui um trecho de código para validar a reposta retornada da resposta retornada por uma chamada a API. Todas as vezes que for necessário executar uma lógica mais avançada, incluindo algoi compo loops, e outras funções mais complexas, isso pode ser feito utilizando funções com código escrito em JavaScript no fluxo do teste.


## Observações finais

Como alguns comentários adicionais, vale ressaltar que:

A estrutura do arquivo YAML, utilizada na definição do arquivo de teste é controlada por recuos ou tabs, ao contrário do JSON, onde o mesmo objeto é alcançado utilizando encadeamento de chaves, e o objeto não necessita de tabulação para ser definido corretamente. Além disso, se dois argumentos iniciam no começam no mesmo nível de tabulação, significa que eleas pertemcem ao mesmo objeto, ou comando. Por exemplo, é umportante que as propriedades  `description`, `action` e `args` estejam perfeitamente alinhadas, caso contrário o arquivo estará errado e ao tentar executar o teste será retornada uma falha.
Em qualquer editor de texto moderno, como o [Visual Studio Code]() é possivel escrever trechos do arquivo YAMl rapidamente e devidamente tabulados utilizando o TAB.
